<RibbonWindow x:Class="Samm.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:com="clr-namespace:Com.Model;assembly=Com"
        xmlns:local="clr-namespace:Samm"
        x:Name="UI"
        Title="ConceptMix Application" 
        Icon="Images\default.ico"
        DataContext="{Binding RelativeSource={RelativeSource Self}}"
        >

    <RibbonWindow.Resources>
        <!--
        - Multi-selection in tree view: http://stackoverflow.com/questions/459375/customizing-the-treeview-to-allow-multi-select
        - p675. Modify visual reprsentation of an item depending on property including data properties and visual properties (e.g., selected dim/set can show more information)
          - Use a data trigger. Set a property in a template depending on a property in the data object. 
            The object (like Set) has to implement INotifyPropertyChanged if the property can change and it is necessary to update the view.
            http://stackoverflow.com/questions/5010511/wpf-datatemplate-binding-depending-on-the-type-of-a-property
          - Specify value converter as a parameter of binding by implementing IValueConverter or IMultiValueConverter (for converting from multiple properties):
            <Image Source="{Binding Path=ProductImagePath, Converter={StaticResource ImagePathConverter}}"/>
            Background="{Binding Path=CategoryName, Converter={StaticResource CategoryToColorConverter}"
            This approach is good when converters are reused with other templates (say, colors, images etc.)
            http://stackoverflow.com/questions/790896/selecting-datatemplate-based-on-sub-object-type
          - p676. Use a template selector which examines the bound data object and chooses among several templates (works precisely as style selectors). 
            Derive the selector from DataTemplateSelector: http://stackoverflow.com/questions/790896/selecting-datatemplate-based-on-sub-object-type
            Can be used, for instance, to display more information for selected items like Set or Dim. 
          - p.683 Changing visual properties depending on selection property of the whole item (for expanding selected items)
        
        - How to add artificial folder by grouping special items? For example, primitive sets (in the root), identity dimensions, entity dimensions etc.
        - p.691 (ch.21) Data views for sorting, filtering items. Data source has to implement IList (e.g. ObservableCollection), IBindingList or IEnumerable (bad, low performance).
          - Using flags/properties for choosing what to visualize: visualize also lesser (incoming) dimensions, visualize also dimension expansion (expand dimension range set), show only identity dims or only entity dims etc.
          - Custom sorting. One general way is to implement binding properties specially for visualization purposes which will return what is needed for the tree view (and other controls) taking into account flags, filters, properties, dedicated folders for special elements etc.
        - Putting nodes of one kind in a separate folder (say, primitive sets, subsets, identity/entity dimensions etc.)
          - Different types of dimensions (identity/entiy/greater/lesser etc.) either hide or in separate folders 
          Solution: http://www.codeproject.com/Articles/36451/Organizing-Heterogeneous-Data-on-a-WPF-TreeView
          http://stackoverflow.com/questions/2248346/grouping-child-objects-in-wpf-treeview
          Alternative solution: http://www.zagstudio.com/blog/365#.Ufgt3W1Enmg  http://www.zagstudio.com/blog/367#.UfguTm1Enmg
        
            // Criteria to the tree view: 
            // - Conditional visualization (item rendering):
            //   - Primitive concepts either not visualized or visualized in a separate folder (also other kinds of folders either with special class or with special properties)
            //   - Dimension structure visualized (so we need to anayze the identity tree) -> Use multibinding by expanding dimension items (only identities up to the primitive sets)
            //   - Alligning various elements of items across the whole tree like in a table, say, names could be alligned (although it might not be possible for deep children)
            //   - TreeView header (it is probably needed only if we have allignment).
            // - The root (SetRoot) is either shown or hidden so that its direct child sets are listed in tree view at the very first level
            // - Touchable actions: context menu, drag-n-drop, DnD icon changing its appearance depending on the drop area, scrolling etc.
            // - Visualizations: animations during actions (touching, DnD), pitching, external events like process updates or property changes etc. 
            // - Selection and highlighting: multi-selection (including via touch), conditional selection when not all combinations are possible (with warning animation or other visualization). 
            // - Getting unique representation for a (selected or arbitrary) item visualized by a tree item (dim id, set id etc. including root)
-->

        <local:CompositeCollectionConverter x:Name="SubConv" x:Key="SubConv" />

        <!-- Data template to display items of class Set (no matter where they appear in this window) -->
        <HierarchicalDataTemplate DataType="{x:Type com:Set}">
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding Path=IsPrimitive}" Value="true">
                    <Setter Property="TreeViewItem.Foreground" Value="Red"></Setter>
                </DataTrigger>
            </DataTemplate.Triggers>
            <HierarchicalDataTemplate.ItemsSource>
                <MultiBinding  Converter="{StaticResource SubConv}">
                    <Binding Path="SubSets"/>
                    <Binding Path="GreaterDims"/>
                </MultiBinding>
            </HierarchicalDataTemplate.ItemsSource>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding Path=Name}" />
            </StackPanel>
        </HierarchicalDataTemplate>

        <!-- Data template to display items of class Dim (no matter where they appear in this window) -->
        <DataTemplate DataType="{x:Type com:Dim}">
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding Path=IsIdentity}" Value="true">
                    <Setter Property="TreeViewItem.Foreground" Value="Red"></Setter>
                </DataTrigger>
            </DataTemplate.Triggers>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding Path=Name}" Foreground="Blue"/>
                <TextBlock Text=" : " Width="10"/>
                <TextBlock Text="{Binding Path=GreaterSet.Name}"/>
                <TextBlock Text=" : " Width="10"/>
                <TextBlock Text="{Binding Path=IsIdentity}"/>
            </StackPanel>
        </DataTemplate>

        <!-- Grid for visualizing a set -->
        <Style x:Key="GridHeaderStyle" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="FontSize" Value="12" />
        </Style>

        <Style x:Key="ReadOnlyGridStyle" TargetType="{x:Type DataGrid}" >
            <Setter Property="AutoGenerateColumns" Value="False" />
            <Setter Property="IsReadOnly" Value="True" />
            <Setter Property="GridLinesVisibility" Value="None" />
            <Setter Property="CanUserAddRows" Value="False" />
            <Setter Property="CanUserDeleteRows" Value="False" />
            <Setter Property="CanUserResizeColumns" Value="True" />
            <Setter Property="CanUserResizeRows" Value="False" />
            <Setter Property="CanUserReorderColumns" Value="True" />
            <Setter Property="ColumnHeaderStyle" Value="{StaticResource GridHeaderStyle}" />
        </Style>

        <DataTemplate x:Key="CellTemplate">
            <Border Padding="3" Background="Purple">
                <TextBox Text="{Binding Path=.}" />
            </Border>
        </DataTemplate>

        <!-- Commands can be (and should be later) defined programmatically as classes -->
        <RoutedUICommand x:Key="OpenTableCommand" Text="Open Table" />
        <RoutedUICommand x:Key="AccessDatasourceCommand" Text="Access Database" />
        <RoutedUICommand x:Key="SqlserverDatasourceCommand" Text="Sql Server Database" />
        <RoutedUICommand x:Key="ImportTableCommand" Text="Import Table" />
        <RoutedUICommand x:Key="AddAggregationCommand" Text="Add Aggregation" />
        <RoutedUICommand x:Key="AddCalculatedCommand" Text="Add Calculation" />
        <RoutedUICommand x:Key="AboutCommand" Text="About" />

    </RibbonWindow.Resources>

    <Window.CommandBindings>
        <CommandBinding Command="{StaticResource OpenTableCommand}" Executed="OpenTableCommand_Executed" />
        <CommandBinding Command="{StaticResource AccessDatasourceCommand}" Executed="AccessDatasourceCommand_Executed" />
        <CommandBinding Command="{StaticResource SqlserverDatasourceCommand}" Executed="SqlserverDatasourceCommand_Executed" />
        <CommandBinding Command="{StaticResource ImportTableCommand}" Executed="ImportTableCommand_Executed" />
        <CommandBinding Command="{StaticResource AddAggregationCommand}" Executed="AddAggregationCommand_Executed" />
        <CommandBinding Command="{StaticResource AddCalculatedCommand}" Executed="AddCalculatedCommand_Executed" />
        <CommandBinding Command="{StaticResource AboutCommand}" Executed="AboutCommand_Executed" />
    </Window.CommandBindings>

    <DockPanel LastChildFill="True">

        <Ribbon x:Name="RibbonWin" DockPanel.Dock="Top" SelectedIndex="0">

            <!-- Help Pane, located at the right-hand side -->
            <Ribbon.HelpPaneContent>
                <RibbonButton SmallImageSource="Images\help.png" />
            </Ribbon.HelpPaneContent>

            <!-- Quick Access Toolbar - located at the upper-left corner -->
            <Ribbon.QuickAccessToolBar>
                <RibbonQuickAccessToolBar>
                    <RibbonButton x:Name ="Save" SmallImageSource="Images\default.ico" />
                    <RibbonSplitButton x:Name ="Update" SmallImageSource="Images\default.ico">
                        <RibbonSplitMenuItem Header="Update All"/>
                        <RibbonSplitMenuItem Header="Update local (recompute)"/>
                        <RibbonSplitMenuItem Header="Update table (and depending tables)"/>
                    </RibbonSplitButton>
                </RibbonQuickAccessToolBar>
            </Ribbon.QuickAccessToolBar>

            <!-- Application Menu, located at the left-hand side (down arrow) -->
            <Ribbon.ApplicationMenu>
                <RibbonApplicationMenu KeyTip="F">
                    <RibbonApplicationMenuItem Header="{Binding RelativeSource={RelativeSource Self}, Path=Command.Text}" ImageSource="Images\default.ico" Command="ApplicationCommands.New"/>
                    <RibbonApplicationMenuItem Header="Open" ImageSource="Images\default.ico" Command="ApplicationCommands.Open"/>
                    <RibbonApplicationMenuItem Header="Close" ImageSource="Images\default.ico" Command="ApplicationCommands.Close"/>
                    <RibbonApplicationMenuItem Header="Save" ImageSource="Images\default.ico" Command="ApplicationCommands.Save"/>
                    <RibbonApplicationMenuItem Header="Save As..." ImageSource="Images\default.ico" Command="ApplicationCommands.SaveAs"/>
                    <RibbonApplicationMenuItem Header="Options" ImageSource="Images\default.ico" />
                    <RibbonApplicationMenuItem Header="About" ImageSource="Images\default.ico" Command="{StaticResource AboutCommand}" />
                    <RibbonApplicationMenuItem Header="Exit" ImageSource="Images\default.ico" />
                </RibbonApplicationMenu>
            </Ribbon.ApplicationMenu>

            <!-- Ribbon Tab Home/File -->
            <RibbonTab Header="Home" KeyTip="H" >
                <!-- Home  group-->
                <RibbonGroup x:Name="ClipboardGroup" Header="Home">
                    <RibbonMenuButton LargeImageSource="Images\paste.png" Label="Paste" KeyTip="V">
                        <RibbonMenuItem ImageSource="Images\paste.png" Header="Keep Text Only" KeyTip="T"/>
                        <RibbonMenuItem ImageSource="Images\paste.png" Header="Paste Special..." KeyTip="S"/>
                    </RibbonMenuButton>
                    <RibbonButton SmallImageSource="Images\cut.png" Label="Cut" KeyTip="X" />
                    <RibbonButton SmallImageSource="Images\copy.png" Label="Copy" KeyTip="C" />
                </RibbonGroup>
            </RibbonTab>

            <!-- Ribbon Tab View -->
            <RibbonTab Header="View" KeyTip="V">
                <RibbonGroup x:Name="windowGroup" Header="Window">
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Window" KeyTip="W" />
                </RibbonGroup>
            </RibbonTab>

            <!-- Ribbon Tab Data Source -->
            <RibbonTab Header="Data Source" KeyTip="S">
                <RibbonGroup x:Name="dataSourceGroup" Header="Microsoft">
                    <RibbonButton LargeImageSource="Images\add_access.png" Label="Access Database" KeyTip="A" Command="{StaticResource AccessDatasourceCommand}" />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="SQL Server" KeyTip="X" Command="{StaticResource SqlserverDatasourceCommand}" />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Remove Data Source" KeyTip="R"/>
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Search Data Source" KeyTip="S"/>
                </RibbonGroup>
            </RibbonTab>

            <!-- Ribbon Tab Insert -->
            <RibbonTab Header="Insert" KeyTip="I" >
                <RibbonGroup x:Name="tableMenuGroup" Header="Tables">
                    <RibbonButton LargeImageSource="Images\add_table.png" Label="Import Table" KeyTip="I" Command="{StaticResource ImportTableCommand}" />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Add Filtered Table" KeyTip="F" />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Remove Table" KeyTip="R" />
                </RibbonGroup>
                <RibbonGroup x:Name="columnMenuGroup" Header="Columns">
                    <RibbonButton LargeImageSource="Images\add_aggregation.png" Label="Add Aggregation Column" KeyTip="A" Command="{StaticResource AddAggregationCommand}" />
                    <RibbonButton LargeImageSource="Images\add_aggregation.png" Label="Add Arithmetic Column" KeyTip="R" Command="{StaticResource AddCalculatedCommand}" />
                </RibbonGroup>
            </RibbonTab>

            <!-- Ribbon Tab Data -->
            <RibbonTab Header="Data" KeyTip="D" >
                <RibbonGroup Header="Update">
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Update All" KeyTip="A" />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Update Local (Recompute)" KeyTip="L" />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Update Table" KeyTip="T" />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Update Column" KeyTip="C" />
                </RibbonGroup>
                <RibbonGroup Header="Selection Propagation">
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Propagate All" KeyTip="A"  />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Propagate From Table" KeyTip="F" />
                    <RibbonButton LargeImageSource="Images\default.ico" Label="Propagate To Table" KeyTip="T" />
                </RibbonGroup>
            </RibbonTab>

        </Ribbon>

        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Name="statBarText" Text="Ready"/>
            </StatusBarItem>
        </StatusBar>

        <Grid>
            <!-- Define the rows and columns -->
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="4*"/>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <GridSplitter Grid.Column ="1" Width ="5" ResizeDirection="Columns" VerticalAlignment="Stretch" HorizontalAlignment="Center" Background ="AliceBlue" />
            <GridSplitter Grid.Column ="3" Width ="5" ResizeDirection="Columns" VerticalAlignment="Stretch" HorizontalAlignment="Center" Background ="AliceBlue" />

            <!-- Data source panel -->
            <Grid Name="DsPanel" Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Label Name="lblDatasources" Grid.Row="0" FontSize="16" Margin="5" >Data sources</Label>

                <TreeView Name="DsView" Grid.Row="1"
                          BorderThickness="0" 
                          ScrollViewer.VerticalScrollBarVisibility="Visible" 
                          ScrollViewer.HorizontalScrollBarVisibility="Auto" 
                          ItemsSource="{Binding DsModel}"
                          MouseDoubleClick="MashupView_MouseDoubleClick"
                          >
                </TreeView>
            </Grid>

            <!-- Workspace panel -->
            <StackPanel Name="WorkspacePanel" Grid.Column="2" >
                <Label Name="lblWorkspace" FontSize="16" Margin="10,10,0,0">WORKSPACE PANEL</Label>
                <StackPanel Name="GridPanel">
                </StackPanel>
            </StackPanel>

            <!-- Mashup panel -->
            <Grid Name="MashupPanel" Grid.Column="4" >
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Label Name="lblMashup" Grid.Row="0" FontSize="16" Margin="5">Data mashup</Label>

                <TreeView Name="MashupView" Grid.Row="1"
                          BorderThickness="0" 
                          ScrollViewer.VerticalScrollBarVisibility="Visible" 
                          ScrollViewer.HorizontalScrollBarVisibility="Auto" 
                          ItemsSource="{Binding MashupModel}"
                          MouseDoubleClick="MashupView_MouseDoubleClick"
                          >
                </TreeView>
            </Grid>

        </Grid>

    </DockPanel>
</RibbonWindow>
